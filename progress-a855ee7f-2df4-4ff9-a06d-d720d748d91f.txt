
## 2026-02-16 19:33 - US-002: Define brand design tokens and typographic hierarchy types
- Created `server/src/types/textSystem.ts` with interfaces: TypographyToken, BrandTokenSet, AdIntent, AdIntentPreset, TextHierarchyConfig, SafeZoneSpec
- Created `server/src/designTokens.ts` with exports: TYPOGRAPHY_SCALE, COLOR_TOKENS, SPACING_TOKENS, SAFE_ZONE_SPECS, AD_INTENT_PRESETS, FONT_SIZE_CLAMPS
- 3 ad intent presets: conversion (high CTA emphasis), awareness (low CTA), retargeting (medium)
- All font size clamps: min >= 14, max <= 96
- Created `server/src/designTokens.test.ts` with tests for all token constraints, WCAG AA contrast, safe zones, presets
- All 176 tests pass, build passes
- **Learnings:** types/ subdirectory works fine with existing tsconfig bundler resolution
---

## 2026-02-16 19:43 - US-003: Build new text sizing engine with dynamic clamps and safe zone enforcement
- Created `server/src/textSizingEngine.ts` with three exports:
  - `calculateDynamicFontSize`: binary search for optimal size within token min/max, uses char count + line wrap estimation
  - `enforceContentSafeZone`: repositions elements into safe bounds for feed/story/reel formats
  - `constrainLineLength`: word-boundary-aware line breaking
- Created `server/src/textSizingEngine.test.ts` with 20 test cases across all three functions
- All 196 server tests pass, typecheck passes
- **Learnings:** Binary search works well for font sizing with integer px values; SAFE_ZONE_SPECS from designTokens provides format-specific margins
---

## 2026-02-16 19:53 - US-004: Build reusable CTA module with token-based styling
- Created `server/src/ctaModule.ts` with `generateCtaConfig(text, brandTokens, intent, format)`
- Returns full CTA config: text, fontSize, padding, borderRadius, bgColor, textColor, contrastRatio, position, minWidth, minHeight
- WCAG AA contrast enforcement (>=4.5) with automatic fallback to high-contrast pairs
- Format-aware sizing: story/reel get larger fonts and padding via scaling factors
- Minimum 44px touch targets enforced for all formats
- Text truncation to CHAR_LIMITS.cta (16 chars)
- Intent-driven emphasis: conversion=high (larger CTA), awareness=low (subtle), retargeting=medium
- Created `server/src/ctaModule.test.ts` with 60 tests: 9 intent×format combos (6 assertions each) + 4 edge case tests
- All 256 tests pass, typecheck passes
- **Learnings:** contrastRatio helper is reusable for any future color accessibility checks
---

## 2026-02-16 20:23 - US-007: Update copyEngine.ts to support intent-based copy strategy
- Added `import type { AdIntent }` to copyEngine.ts
- Added optional `intent?: AdIntent` field to `CopyInput` interface
- Updated `formulaCandidates()`: intent takes priority over objective/category — retargeting→proof/benefit/question, conversion→urgency/number/benefit, awareness→benefit/curiosity/question
- Updated `ctaCandidates()`: intent takes priority — retargeting uses dedicated RETARGETING_CTA_CANDIDATES
- Exported `RETARGETING_CTA_CANDIDATES` with 5 options: Come Back, Still Interested?, Complete Order, Finish Checkout, Return & Save
- Added conversion and awareness intent-specific CTA lists
- Added 8 new tests: intent acceptance, retargeting CTAs, retargeting CTA count, formula differentiation between intents, awareness formula verification, conversion CTAs, char limits for all intents, backward compatibility without intent
- All 285 tests pass, typecheck passes
---

## 2026-02-16 20:33 - US-008: Wire intent presets into generateAd endpoint
- Updated `server/src/generateAd.ts`: added `intent` to AdSpec metadata type, `generateAdSpec` signature, endpoint request body parsing
- Intent is validated against allowed values; invalid values are silently ignored
- Passes intent through to `generateCopy` and `generateLayout`
- Added 8 new tests: intent in metadata, backward compat, invalid intent ignored, different copy for retargeting vs conversion, all three intents accepted, generateAdSpec direct tests
- All 292 tests pass, typecheck passes
---

## 2026-02-16 21:24 - US-009: Update client-side safe zone types and format constants
- Updated `client/src/types/safeZones.ts`: added optional topMargin, bottomMargin, rightMargin to SafeZoneConfig; story gets 14% top / 35% bottom; added reel format with 15% right margin
- Updated `client/src/types/formats.ts`: added reel format (1080x1920)
- Updated `getSafeZonePixels` to use asymmetric margins when present
- Created `client/src/types/safeZones.test.ts` (11 tests) and `client/src/types/formats.test.ts` (4 tests)
- Fixed `client/src/hooks/useGridOverlay.test.ts` and `client/src/components/FormatSelector.test.tsx` for new format count and margins
- All 221 client tests pass, typecheck passes
- **Learnings:** Client vitest has globals: true, so import from vitest is optional but explicit is fine
---
